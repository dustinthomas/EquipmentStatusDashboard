import{z as x,A as $,B as m,C as S,x as g,D as q}from"./index-BDGxoy4u.js";const I=x("toolDetail",()=>{const{get:p,post:_}=q(),u=$(),a=m(null),c=m(!1),n=m(null),t=S({visible:!1,submitting:!1,error:null,state:"",issue_description:"",comment:"",eta_to_up:""}),e=S({events:[],toolName:"",loading:!1,error:null,fromDate:"",toDate:""}),h=[{value:"UP",label:"Up",class:"status-up"},{value:"UP_WITH_ISSUES",label:"Up with Issues",class:"status-up-with-issues"},{value:"MAINTENANCE",label:"Maintenance",class:"status-maintenance"},{value:"DOWN",label:"Down",class:"status-down"}],y=g(()=>e.fromDate!==""||e.toDate!==""),b=g(()=>t.state!=="UP");async function w(s){c.value=!0,n.value=null,a.value=null;const{data:o,error:r,status:i}=await p(`/api/tools/${s}`);i===401?(u.clearAuth(),n.value="Session expired. Please log in again."):i===404?n.value="Tool not found":r?n.value=r:a.value=o.tool,c.value=!1}function v(s){if(!s)return"";try{const o=new Date(s);return isNaN(o.getTime())?"":o.toISOString().slice(0,16)}catch{return""}}function A(){a.value&&(t.state=a.value.state||"",t.issue_description=a.value.issue_description||"",t.comment=a.value.comment||"",t.eta_to_up=v(a.value.eta_to_up),t.error=null,t.visible=!0)}function F(){t.visible=!1,t.error=null}async function N(s){if(!t.state)return t.error="Status is required",!1;t.submitting=!0,t.error=null;const o={state:t.state};t.issue_description.trim()&&(o.issue_description=t.issue_description.trim()),t.comment.trim()&&(o.comment=t.comment.trim()),t.state!=="UP"&&t.eta_to_up&&(o.eta_to_up=t.eta_to_up);const{data:r,error:i,status:l}=await _(`/api/tools/${s}/status`,o);return l===401?(u.clearAuth(),t.error="Session expired. Please log in again.",t.submitting=!1,!1):i?(t.error=i,t.submitting=!1,!1):(a.value=r.tool,t.visible=!1,t.submitting=!1,!0)}async function f(s){e.loading=!0,e.error=null,e.events=[];const o=new URLSearchParams;e.fromDate&&o.set("from",e.fromDate),e.toDate&&o.set("to",e.toDate);const r=o.toString(),i=`/api/tools/${s}/history${r?"?"+r:""}`,{data:l,error:d,status:D}=await p(i);D===401?(u.clearAuth(),e.error="Session expired. Please log in again."):D===404?e.error="Tool not found":d?e.error=d:(e.events=l.events||[],e.toolName=l.tool_name||""),e.loading=!1}function P(s){s&&f(s)}function T(s){e.fromDate="",e.toDate="",s&&f(s)}function U(s){if(!s)return;const o=new URLSearchParams;e.fromDate&&o.set("from",e.fromDate),e.toDate&&o.set("to",e.toDate);const r=o.toString(),i=`/api/tools/${s}/history.csv${r?"?"+r:""}`;window.open(i,"_blank")}function E(){a.value=null,n.value=null,t.visible=!1,t.error=null}function H(){e.events=[],e.toolName="",e.error=null,e.fromDate="",e.toDate=""}return{tool:a,loading:c,error:n,statusForm:t,validStates:h,history:e,hasActiveHistoryFilters:y,shouldShowEtaField:b,fetchTool:w,formatDateTimeForInput:v,openStatusForm:A,closeStatusForm:F,submitStatusForm:N,fetchHistory:f,applyHistoryFilters:P,clearHistoryFilters:T,exportHistoryCsv:U,clearTool:E,clearHistory:H}});export{I as u};
