import{z as R,A as j,B as G,C as p,x as T,D as J}from"./index-BDGxoy4u.js";const Q=R("admin",()=>{const{get:y,post:f,put:v}=J(),m=j(),M=G("tools"),i=p({items:[],meta:{},loading:!1,error:null,search:"",sortColumn:"name",sortDirection:"asc"}),o=p({items:[],meta:{},loading:!1,error:null,search:"",sortColumn:"name",sortDirection:"asc"}),s=p({visible:!1,mode:"create",submitting:!1,error:null,successMessage:null,id:null,name:"",area:"",bay:"",criticality:"medium"}),r=p({visible:!1,mode:"create",submitting:!1,error:null,successMessage:null,id:null,username:"",name:"",password:"",role:"operator"}),n=p({visible:!1,submitting:!1,error:null,successMessage:null,userId:null,userName:"",password:""}),D=[{value:"critical",label:"Critical"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}],S=[{value:"admin",label:"Admin"},{value:"operator",label:"Operator"}],P=T(()=>{let e=[...i.items];if(i.search.trim()){const d=i.search.toLowerCase().trim();e=e.filter(c=>c.name.toLowerCase().includes(d))}const t=i.sortColumn,l=i.sortDirection==="asc"?1:-1;return e.sort((d,c)=>{let a=d[t],u=c[t];if(t==="criticality"){const g={critical:0,high:1,medium:2,low:3};a=g[a]??4,u=g[u]??4}else typeof a=="string"&&(a=a.toLowerCase(),u=u.toLowerCase());return a<u?-1*l:a>u?1*l:0}),e}),L=T(()=>{let e=[...o.items];if(o.search.trim()){const d=o.search.toLowerCase().trim();e=e.filter(c=>c.username.toLowerCase().includes(d)||c.name.toLowerCase().includes(d))}const t=o.sortColumn,l=o.sortDirection==="asc"?1:-1;return e.sort((d,c)=>{let a=d[t],u=c[t];if(t==="last_login_at")a=a?new Date(a).getTime():l===1?1/0:-1/0,u=u?new Date(u).getTime():l===1?1/0:-1/0;else if(t==="role"){const g={admin:0,operator:1};a=g[a]??2,u=g[u]??2}else typeof a=="string"&&(a=a.toLowerCase(),u=u.toLowerCase());return a<u?-1*l:a>u?1*l:0}),e});async function b(){i.loading=!0,i.error=null;const{data:e,error:t,status:l}=await y("/api/admin/tools");l===401?(m.clearAuth(),i.error="Session expired. Please log in again."):l===403?i.error="Access denied. Admin privileges required.":t?i.error=t:(i.items=e.tools||[],i.meta=e.meta||{}),i.loading=!1}function U(e){i.sortColumn===e?i.sortDirection=i.sortDirection==="asc"?"desc":"asc":(i.sortColumn=e,i.sortDirection="asc")}function $(e){return i.sortColumn!==e?"sortable":i.sortDirection==="asc"?"sorted-asc":"sorted-desc"}function x(){s.mode="create",s.id=null,s.name="",s.area="",s.bay="",s.criticality="medium",s.error=null,s.successMessage=null,s.visible=!0}function E(e){s.mode="edit",s.id=e.id,s.name=e.name,s.area=e.area,s.bay=e.bay||"",s.criticality=e.criticality,s.error=null,s.successMessage=null,s.visible=!0}function h(){s.visible=!1,s.error=null,s.successMessage=null}async function q(){if(!s.name.trim())return s.error="Name is required",!1;if(!s.area.trim())return s.error="Area is required",!1;s.submitting=!0,s.error=null;const e={name:s.name.trim(),area:s.area.trim(),bay:s.bay.trim(),criticality:s.criticality},t=s.mode==="create",l=t?"/api/admin/tools":`/api/admin/tools/${s.id}`,d=t?f:v,{data:c,error:a,status:u}=await d(l,e);return u===401?(m.clearAuth(),s.error="Session expired. Please log in again.",s.submitting=!1,!1):a?(s.error=a,s.submitting=!1,!1):(s.successMessage=t?"Tool created successfully":"Tool updated successfully",await b(),setTimeout(()=>{h()},1e3),s.submitting=!1,!0)}async function I(e){const t=e.is_active?"deactivate":"activate";if(!confirm(`Are you sure you want to ${t} "${e.name}"?`))return;const{data:d,error:c,status:a}=await f(`/api/admin/tools/${e.id}/toggle-active`);a===401?(m.clearAuth(),i.error="Session expired. Please log in again."):c?i.error=c||`Failed to ${t} tool`:await b()}async function w(){o.loading=!0,o.error=null;const{data:e,error:t,status:l}=await y("/api/admin/users");l===401?(m.clearAuth(),o.error="Session expired. Please log in again."):l===403?o.error="Access denied. Admin privileges required.":t?o.error=t:(o.items=e.users||[],o.meta=e.meta||{}),o.loading=!1}function N(e){o.sortColumn===e?o.sortDirection=o.sortDirection==="asc"?"desc":"asc":(o.sortColumn=e,o.sortDirection="asc")}function V(e){return o.sortColumn!==e?"sortable":o.sortDirection==="asc"?"sorted-asc":"sorted-desc"}function _(){r.mode="create",r.id=null,r.username="",r.name="",r.password="",r.role="operator",r.error=null,r.successMessage=null,r.visible=!0}function k(e){r.mode="edit",r.id=e.id,r.username=e.username,r.name=e.name,r.password="",r.role=e.role,r.error=null,r.successMessage=null,r.visible=!0}function C(){r.visible=!1,r.error=null,r.successMessage=null}async function F(){if(!r.username.trim())return r.error="Username is required",!1;if(!r.name.trim())return r.error="Name is required",!1;if(r.mode==="create"&&!r.password.trim())return r.error="Password is required",!1;r.submitting=!0,r.error=null;const e={username:r.username.trim(),name:r.name.trim(),role:r.role};r.mode==="create"&&(e.password=r.password);const t=r.mode==="create",l=t?"/api/admin/users":`/api/admin/users/${r.id}`,d=t?f:v,{data:c,error:a,status:u}=await d(l,e);return u===401?(m.clearAuth(),r.error="Session expired. Please log in again.",r.submitting=!1,!1):a?(r.error=a,r.submitting=!1,!1):(r.successMessage=t?"User created successfully":"User updated successfully",await w(),setTimeout(()=>{C()},1e3),r.submitting=!1,!0)}async function z(e){const t=e.is_active?"deactivate":"activate";if(!confirm(`Are you sure you want to ${t} "${e.name}"?`))return;const{data:d,error:c,status:a}=await f(`/api/admin/users/${e.id}/toggle-active`);a===401?(m.clearAuth(),o.error="Session expired. Please log in again."):c?o.error=c||`Failed to ${t} user`:await w()}function B(e){n.userId=e.id,n.userName=e.name,n.password="",n.error=null,n.successMessage=null,n.visible=!0}function A(){n.visible=!1,n.error=null,n.successMessage=null}async function H(){if(!n.password.trim())return n.error="Password is required",!1;n.submitting=!0,n.error=null;const{data:e,error:t,status:l}=await f(`/api/admin/users/${n.userId}/reset-password`,{password:n.password});return l===401?(m.clearAuth(),n.error="Session expired. Please log in again.",n.submitting=!1,!1):t?(n.error=t,n.submitting=!1,!1):(n.successMessage="Password reset successfully",await w(),setTimeout(()=>{A()},1e3),n.submitting=!1,!0)}function O(e){M.value=e}return{currentTab:M,tools:i,users:o,toolModal:s,userModal:r,passwordModal:n,validCriticalities:D,validRoles:S,filteredTools:P,filteredUsers:L,fetchTools:b,handleToolSortClick:U,getToolSortClass:$,openAddToolModal:x,openEditToolModal:E,closeToolModal:h,submitToolModal:q,toggleToolActive:I,fetchUsers:w,handleUserSortClick:N,getUserSortClass:V,openAddUserModal:_,openEditUserModal:k,closeUserModal:C,submitUserModal:F,toggleUserActive:z,openPasswordModal:B,closePasswordModal:A,submitPasswordModal:H,switchTab:O}});export{Q as u};
